{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity */\nvar util = require('./util');\n\nvar Q = require('q');\n\nvar AuthApiError = require('./errors/AuthApiError');\n\nvar config = require('./config');\n\nfunction httpRequest(sdk, options) {\n  options = options || {};\n  var url = options.url,\n      method = options.method,\n      args = options.args,\n      saveAuthnState = options.saveAuthnState,\n      accessToken = options.accessToken,\n      withCredentials = options.withCredentials !== false,\n      // default value is true\n  storageUtil = sdk.options.storageUtil,\n      storage = storageUtil.storage,\n      httpCache = storageUtil.getHttpCache();\n\n  if (options.cacheResponse) {\n    var cacheContents = httpCache.getStorage();\n    var cachedResponse = cacheContents[url];\n\n    if (cachedResponse && Date.now() / 1000 < cachedResponse.expiresAt) {\n      return Q.resolve(cachedResponse.response);\n    }\n  }\n\n  var headers = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n    'X-Okta-User-Agent-Extended': sdk.userAgent\n  };\n  util.extend(headers, sdk.options.headers, options.headers);\n\n  if (accessToken && util.isString(accessToken)) {\n    headers['Authorization'] = 'Bearer ' + accessToken;\n  }\n\n  var ajaxOptions = {\n    headers: headers,\n    data: args || undefined,\n    withCredentials: withCredentials\n  };\n  var err, res;\n  return new Q(sdk.options.httpRequestClient(method, url, ajaxOptions)).then(function (resp) {\n    res = resp.responseText;\n\n    if (res && util.isString(res)) {\n      res = JSON.parse(res);\n    }\n\n    if (saveAuthnState) {\n      if (!res.stateToken) {\n        storage.delete(config.STATE_TOKEN_KEY_NAME);\n      }\n    }\n\n    if (res && res.stateToken && res.expiresAt) {\n      storage.set(config.STATE_TOKEN_KEY_NAME, res.stateToken, res.expiresAt);\n    }\n\n    if (res && options.cacheResponse) {\n      httpCache.updateStorage(url, {\n        expiresAt: Math.floor(Date.now() / 1000) + config.DEFAULT_CACHE_DURATION,\n        response: res\n      });\n    }\n\n    return res;\n  }).fail(function (resp) {\n    var serverErr = resp.responseText || {};\n\n    if (util.isString(serverErr)) {\n      try {\n        serverErr = JSON.parse(serverErr);\n      } catch (e) {\n        serverErr = {\n          errorSummary: 'Unknown error'\n        };\n      }\n    }\n\n    if (resp.status >= 500) {\n      serverErr.errorSummary = 'Unknown error';\n    }\n\n    if (sdk.options.transformErrorXHR) {\n      resp = sdk.options.transformErrorXHR(util.clone(resp));\n    }\n\n    err = new AuthApiError(serverErr, resp);\n\n    if (err.errorCode === 'E0000011') {\n      storage.delete(config.STATE_TOKEN_KEY_NAME);\n    }\n\n    throw err;\n  });\n}\n\nfunction get(sdk, url, options) {\n  url = util.isAbsoluteUrl(url) ? url : sdk.options.url + url;\n  var getOptions = {\n    url: url,\n    method: 'GET'\n  };\n  util.extend(getOptions, options);\n  return httpRequest(sdk, getOptions);\n}\n\nfunction post(sdk, url, args, options) {\n  url = util.isAbsoluteUrl(url) ? url : sdk.options.url + url;\n  var postOptions = {\n    url: url,\n    method: 'POST',\n    args: args,\n    saveAuthnState: true\n  };\n  util.extend(postOptions, options);\n  return httpRequest(sdk, postOptions);\n}\n\nmodule.exports = {\n  get: get,\n  post: post,\n  httpRequest: httpRequest\n};","map":{"version":3,"sources":["/app/node_modules/@okta/okta-auth-js/lib/http.js"],"names":["util","require","Q","AuthApiError","config","httpRequest","sdk","options","url","method","args","saveAuthnState","accessToken","withCredentials","storageUtil","storage","httpCache","getHttpCache","cacheResponse","cacheContents","getStorage","cachedResponse","Date","now","expiresAt","resolve","response","headers","userAgent","extend","isString","ajaxOptions","data","undefined","err","res","httpRequestClient","then","resp","responseText","JSON","parse","stateToken","delete","STATE_TOKEN_KEY_NAME","set","updateStorage","Math","floor","DEFAULT_CACHE_DURATION","fail","serverErr","e","errorSummary","status","transformErrorXHR","clone","errorCode","get","isAbsoluteUrl","getOptions","post","postOptions","module","exports"],"mappings":"AAAA;;;;;;;;;;;;;AAaA;AACA,IAAIA,IAAI,GAAGC,OAAO,CAAC,QAAD,CAAlB;;AACA,IAAIC,CAAC,GAAGD,OAAO,CAAC,GAAD,CAAf;;AACA,IAAIE,YAAY,GAAGF,OAAO,CAAC,uBAAD,CAA1B;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAApB;;AAEA,SAASI,WAAT,CAAqBC,GAArB,EAA0BC,OAA1B,EAAmC;AACjCA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,MAAIC,GAAG,GAAGD,OAAO,CAACC,GAAlB;AAAA,MACIC,MAAM,GAAGF,OAAO,CAACE,MADrB;AAAA,MAEIC,IAAI,GAAGH,OAAO,CAACG,IAFnB;AAAA,MAGIC,cAAc,GAAGJ,OAAO,CAACI,cAH7B;AAAA,MAIIC,WAAW,GAAGL,OAAO,CAACK,WAJ1B;AAAA,MAKIC,eAAe,GAAGN,OAAO,CAACM,eAAR,KAA4B,KALlD;AAAA,MAKyD;AACrDC,EAAAA,WAAW,GAAGR,GAAG,CAACC,OAAJ,CAAYO,WAN9B;AAAA,MAOIC,OAAO,GAAGD,WAAW,CAACC,OAP1B;AAAA,MAQIC,SAAS,GAAGF,WAAW,CAACG,YAAZ,EARhB;;AAUA,MAAIV,OAAO,CAACW,aAAZ,EAA2B;AACzB,QAAIC,aAAa,GAAGH,SAAS,CAACI,UAAV,EAApB;AACA,QAAIC,cAAc,GAAGF,aAAa,CAACX,GAAD,CAAlC;;AACA,QAAIa,cAAc,IAAIC,IAAI,CAACC,GAAL,KAAW,IAAX,GAAkBF,cAAc,CAACG,SAAvD,EAAkE;AAChE,aAAOtB,CAAC,CAACuB,OAAF,CAAUJ,cAAc,CAACK,QAAzB,CAAP;AACD;AACF;;AAED,MAAIC,OAAO,GAAG;AACZ,cAAU,kBADE;AAEZ,oBAAgB,kBAFJ;AAGZ,kCAA8BrB,GAAG,CAACsB;AAHtB,GAAd;AAKA5B,EAAAA,IAAI,CAAC6B,MAAL,CAAYF,OAAZ,EAAqBrB,GAAG,CAACC,OAAJ,CAAYoB,OAAjC,EAA0CpB,OAAO,CAACoB,OAAlD;;AAEA,MAAIf,WAAW,IAAIZ,IAAI,CAAC8B,QAAL,CAAclB,WAAd,CAAnB,EAA+C;AAC7Ce,IAAAA,OAAO,CAAC,eAAD,CAAP,GAA2B,YAAYf,WAAvC;AACD;;AAED,MAAImB,WAAW,GAAG;AAChBJ,IAAAA,OAAO,EAAEA,OADO;AAEhBK,IAAAA,IAAI,EAAEtB,IAAI,IAAIuB,SAFE;AAGhBpB,IAAAA,eAAe,EAAEA;AAHD,GAAlB;AAMA,MAAIqB,GAAJ,EAASC,GAAT;AACA,SAAO,IAAIjC,CAAJ,CAAMI,GAAG,CAACC,OAAJ,CAAY6B,iBAAZ,CAA8B3B,MAA9B,EAAsCD,GAAtC,EAA2CuB,WAA3C,CAAN,EACJM,IADI,CACC,UAASC,IAAT,EAAe;AACnBH,IAAAA,GAAG,GAAGG,IAAI,CAACC,YAAX;;AACA,QAAIJ,GAAG,IAAInC,IAAI,CAAC8B,QAAL,CAAcK,GAAd,CAAX,EAA+B;AAC7BA,MAAAA,GAAG,GAAGK,IAAI,CAACC,KAAL,CAAWN,GAAX,CAAN;AACD;;AAED,QAAIxB,cAAJ,EAAoB;AAClB,UAAI,CAACwB,GAAG,CAACO,UAAT,EAAqB;AACnB3B,QAAAA,OAAO,CAAC4B,MAAR,CAAevC,MAAM,CAACwC,oBAAtB;AACD;AACF;;AAED,QAAIT,GAAG,IAAIA,GAAG,CAACO,UAAX,IAAyBP,GAAG,CAACX,SAAjC,EAA4C;AAC1CT,MAAAA,OAAO,CAAC8B,GAAR,CAAYzC,MAAM,CAACwC,oBAAnB,EAAyCT,GAAG,CAACO,UAA7C,EAAyDP,GAAG,CAACX,SAA7D;AACD;;AAED,QAAIW,GAAG,IAAI5B,OAAO,CAACW,aAAnB,EAAkC;AAChCF,MAAAA,SAAS,CAAC8B,aAAV,CAAwBtC,GAAxB,EAA6B;AAC3BgB,QAAAA,SAAS,EAAEuB,IAAI,CAACC,KAAL,CAAW1B,IAAI,CAACC,GAAL,KAAW,IAAtB,IAA8BnB,MAAM,CAAC6C,sBADrB;AAE3BvB,QAAAA,QAAQ,EAAES;AAFiB,OAA7B;AAID;;AAED,WAAOA,GAAP;AACD,GAzBI,EA0BJe,IA1BI,CA0BC,UAASZ,IAAT,EAAe;AACnB,QAAIa,SAAS,GAAGb,IAAI,CAACC,YAAL,IAAqB,EAArC;;AACA,QAAIvC,IAAI,CAAC8B,QAAL,CAAcqB,SAAd,CAAJ,EAA8B;AAC5B,UAAI;AACFA,QAAAA,SAAS,GAAGX,IAAI,CAACC,KAAL,CAAWU,SAAX,CAAZ;AACD,OAFD,CAEE,OAAOC,CAAP,EAAU;AACVD,QAAAA,SAAS,GAAG;AACVE,UAAAA,YAAY,EAAE;AADJ,SAAZ;AAGD;AACF;;AAED,QAAIf,IAAI,CAACgB,MAAL,IAAe,GAAnB,EAAwB;AACtBH,MAAAA,SAAS,CAACE,YAAV,GAAyB,eAAzB;AACD;;AAED,QAAI/C,GAAG,CAACC,OAAJ,CAAYgD,iBAAhB,EAAmC;AACjCjB,MAAAA,IAAI,GAAGhC,GAAG,CAACC,OAAJ,CAAYgD,iBAAZ,CAA8BvD,IAAI,CAACwD,KAAL,CAAWlB,IAAX,CAA9B,CAAP;AACD;;AAEDJ,IAAAA,GAAG,GAAG,IAAI/B,YAAJ,CAAiBgD,SAAjB,EAA4Bb,IAA5B,CAAN;;AAEA,QAAIJ,GAAG,CAACuB,SAAJ,KAAkB,UAAtB,EAAkC;AAChC1C,MAAAA,OAAO,CAAC4B,MAAR,CAAevC,MAAM,CAACwC,oBAAtB;AACD;;AAED,UAAMV,GAAN;AACD,GArDI,CAAP;AAsDD;;AAED,SAASwB,GAAT,CAAapD,GAAb,EAAkBE,GAAlB,EAAuBD,OAAvB,EAAgC;AAC9BC,EAAAA,GAAG,GAAGR,IAAI,CAAC2D,aAAL,CAAmBnD,GAAnB,IAA0BA,GAA1B,GAAgCF,GAAG,CAACC,OAAJ,CAAYC,GAAZ,GAAkBA,GAAxD;AACA,MAAIoD,UAAU,GAAG;AACfpD,IAAAA,GAAG,EAAEA,GADU;AAEfC,IAAAA,MAAM,EAAE;AAFO,GAAjB;AAIAT,EAAAA,IAAI,CAAC6B,MAAL,CAAY+B,UAAZ,EAAwBrD,OAAxB;AACA,SAAOF,WAAW,CAACC,GAAD,EAAMsD,UAAN,CAAlB;AACD;;AAED,SAASC,IAAT,CAAcvD,GAAd,EAAmBE,GAAnB,EAAwBE,IAAxB,EAA8BH,OAA9B,EAAuC;AACrCC,EAAAA,GAAG,GAAGR,IAAI,CAAC2D,aAAL,CAAmBnD,GAAnB,IAA0BA,GAA1B,GAAgCF,GAAG,CAACC,OAAJ,CAAYC,GAAZ,GAAkBA,GAAxD;AACA,MAAIsD,WAAW,GAAG;AAChBtD,IAAAA,GAAG,EAAEA,GADW;AAEhBC,IAAAA,MAAM,EAAE,MAFQ;AAGhBC,IAAAA,IAAI,EAAEA,IAHU;AAIhBC,IAAAA,cAAc,EAAE;AAJA,GAAlB;AAMAX,EAAAA,IAAI,CAAC6B,MAAL,CAAYiC,WAAZ,EAAyBvD,OAAzB;AACA,SAAOF,WAAW,CAACC,GAAD,EAAMwD,WAAN,CAAlB;AACD;;AAEDC,MAAM,CAACC,OAAP,GAAiB;AACfN,EAAAA,GAAG,EAAEA,GADU;AAEfG,EAAAA,IAAI,EAAEA,IAFS;AAGfxD,EAAAA,WAAW,EAAEA;AAHE,CAAjB","sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity */\nvar util = require('./util');\nvar Q = require('q');\nvar AuthApiError = require('./errors/AuthApiError');\nvar config = require('./config');\n\nfunction httpRequest(sdk, options) {\n  options = options || {};\n  var url = options.url,\n      method = options.method,\n      args = options.args,\n      saveAuthnState = options.saveAuthnState,\n      accessToken = options.accessToken,\n      withCredentials = options.withCredentials !== false, // default value is true\n      storageUtil = sdk.options.storageUtil,\n      storage = storageUtil.storage,\n      httpCache = storageUtil.getHttpCache();\n\n  if (options.cacheResponse) {\n    var cacheContents = httpCache.getStorage();\n    var cachedResponse = cacheContents[url];\n    if (cachedResponse && Date.now()/1000 < cachedResponse.expiresAt) {\n      return Q.resolve(cachedResponse.response);\n    }\n  }\n\n  var headers = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n    'X-Okta-User-Agent-Extended': sdk.userAgent\n  };\n  util.extend(headers, sdk.options.headers, options.headers);\n\n  if (accessToken && util.isString(accessToken)) {\n    headers['Authorization'] = 'Bearer ' + accessToken;\n  }\n\n  var ajaxOptions = {\n    headers: headers,\n    data: args || undefined,\n    withCredentials: withCredentials\n  };\n\n  var err, res;\n  return new Q(sdk.options.httpRequestClient(method, url, ajaxOptions))\n    .then(function(resp) {\n      res = resp.responseText;\n      if (res && util.isString(res)) {\n        res = JSON.parse(res);\n      }\n\n      if (saveAuthnState) {\n        if (!res.stateToken) {\n          storage.delete(config.STATE_TOKEN_KEY_NAME);\n        }\n      }\n\n      if (res && res.stateToken && res.expiresAt) {\n        storage.set(config.STATE_TOKEN_KEY_NAME, res.stateToken, res.expiresAt);\n      }\n\n      if (res && options.cacheResponse) {\n        httpCache.updateStorage(url, {\n          expiresAt: Math.floor(Date.now()/1000) + config.DEFAULT_CACHE_DURATION,\n          response: res\n        });\n      }\n\n      return res;\n    })\n    .fail(function(resp) {\n      var serverErr = resp.responseText || {};\n      if (util.isString(serverErr)) {\n        try {\n          serverErr = JSON.parse(serverErr);\n        } catch (e) {\n          serverErr = {\n            errorSummary: 'Unknown error'\n          };\n        }\n      }\n\n      if (resp.status >= 500) {\n        serverErr.errorSummary = 'Unknown error';\n      }\n\n      if (sdk.options.transformErrorXHR) {\n        resp = sdk.options.transformErrorXHR(util.clone(resp));\n      }\n\n      err = new AuthApiError(serverErr, resp);\n\n      if (err.errorCode === 'E0000011') {\n        storage.delete(config.STATE_TOKEN_KEY_NAME);\n      }\n\n      throw err;\n    });\n}\n\nfunction get(sdk, url, options) {\n  url = util.isAbsoluteUrl(url) ? url : sdk.options.url + url;\n  var getOptions = {\n    url: url,\n    method: 'GET'\n  };\n  util.extend(getOptions, options);\n  return httpRequest(sdk, getOptions);\n}\n\nfunction post(sdk, url, args, options) {\n  url = util.isAbsoluteUrl(url) ? url : sdk.options.url + url;\n  var postOptions = {\n    url: url,\n    method: 'POST',\n    args: args,\n    saveAuthnState: true\n  };\n  util.extend(postOptions, options);\n  return httpRequest(sdk, postOptions);\n}\n\nmodule.exports = {\n  get: get,\n  post: post,\n  httpRequest: httpRequest\n};\n"]},"metadata":{},"sourceType":"script"}