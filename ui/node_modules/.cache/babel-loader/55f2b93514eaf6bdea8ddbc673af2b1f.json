{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\nvar Cookies = require('js-cookie');\n\nvar storageBuilder = require('../storageBuilder');\n\nvar config = require('../config'); // Building this as an object allows us to mock the functions in our tests\n\n\nvar storageUtil = {}; // IE11 bug that Microsoft doesn't plan to fix\n// https://connect.microsoft.com/IE/Feedback/Details/1496040\n\nstorageUtil.browserHasLocalStorage = function () {\n  try {\n    var storage = storageUtil.getLocalStorage();\n    return storageUtil.testStorage(storage);\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.browserHasSessionStorage = function () {\n  try {\n    var storage = storageUtil.getSessionStorage();\n    return storageUtil.testStorage(storage);\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.getPKCEStorage = function () {\n  if (storageUtil.browserHasLocalStorage()) {\n    return storageBuilder(storageUtil.getLocalStorage(), config.PKCE_STORAGE_NAME);\n  } else if (storageUtil.browserHasSessionStorage()) {\n    return storageBuilder(storageUtil.getSessionStorage(), config.PKCE_STORAGE_NAME);\n  } else {\n    return storageBuilder(storageUtil.getCookieStorage(), config.PKCE_STORAGE_NAME);\n  }\n};\n\nstorageUtil.getHttpCache = function () {\n  if (storageUtil.browserHasLocalStorage()) {\n    return storageBuilder(storageUtil.getLocalStorage(), config.CACHE_STORAGE_NAME);\n  } else if (storageUtil.browserHasSessionStorage()) {\n    return storageBuilder(storageUtil.getSessionStorage(), config.CACHE_STORAGE_NAME);\n  } else {\n    return storageBuilder(storageUtil.getCookieStorage(), config.CACHE_STORAGE_NAME);\n  }\n};\n\nstorageUtil.getLocalStorage = function () {\n  return localStorage;\n};\n\nstorageUtil.getSessionStorage = function () {\n  return sessionStorage;\n}; // Provides webStorage-like interface for cookies\n\n\nstorageUtil.getCookieStorage = function (options) {\n  options = options || {};\n  return {\n    getItem: storageUtil.storage.get,\n    setItem: function (key, value) {\n      // Cookie shouldn't expire\n      storageUtil.storage.set(key, value, '2200-01-01T00:00:00.000Z', options.secure);\n    }\n  };\n};\n\nstorageUtil.testStorage = function (storage) {\n  var key = 'okta-test-storage';\n\n  try {\n    storage.setItem(key, key);\n    storage.removeItem(key);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.storage = {\n  set: function (name, value, expiresAt, secure) {\n    var cookieOptions = {\n      path: '/',\n      secure: secure\n    }; // eslint-disable-next-line no-extra-boolean-cast\n\n    if (!!Date.parse(expiresAt)) {\n      // Expires value can be converted to a Date object.\n      //\n      // If the 'expiresAt' value is not provided, or the value cannot be\n      // parsed as a Date object, the cookie will set as a session cookie.\n      cookieOptions.expires = new Date(expiresAt);\n    }\n\n    Cookies.set(name, value, cookieOptions);\n    return storageUtil.storage.get(name);\n  },\n  get: function (name) {\n    return Cookies.get(name);\n  },\n  delete: function (name) {\n    return Cookies.remove(name, {\n      path: '/'\n    });\n  }\n};\nmodule.exports = storageUtil;","map":{"version":3,"sources":["/Users/alanboyce/dev/bittap/ui/node_modules/@okta/okta-auth-js/lib/browser/browserStorage.js"],"names":["Cookies","require","storageBuilder","config","storageUtil","browserHasLocalStorage","storage","getLocalStorage","testStorage","e","browserHasSessionStorage","getSessionStorage","getPKCEStorage","PKCE_STORAGE_NAME","getCookieStorage","getHttpCache","CACHE_STORAGE_NAME","localStorage","sessionStorage","options","getItem","get","setItem","key","value","set","secure","removeItem","name","expiresAt","cookieOptions","path","Date","parse","expires","delete","remove","module","exports"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\nvar Cookies = require('js-cookie');\nvar storageBuilder = require('../storageBuilder');\nvar config = require('../config');\n\n// Building this as an object allows us to mock the functions in our tests\nvar storageUtil = {};\n\n// IE11 bug that Microsoft doesn't plan to fix\n// https://connect.microsoft.com/IE/Feedback/Details/1496040\nstorageUtil.browserHasLocalStorage = function() {\n  try {\n    var storage = storageUtil.getLocalStorage();\n    return storageUtil.testStorage(storage);\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.browserHasSessionStorage = function() {\n  try {\n    var storage = storageUtil.getSessionStorage();\n    return storageUtil.testStorage(storage);\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.getPKCEStorage = function() {\n  if (storageUtil.browserHasLocalStorage()) {\n    return storageBuilder(storageUtil.getLocalStorage(), config.PKCE_STORAGE_NAME);\n  } else if (storageUtil.browserHasSessionStorage()) {\n    return storageBuilder(storageUtil.getSessionStorage(), config.PKCE_STORAGE_NAME);\n  } else {\n    return storageBuilder(storageUtil.getCookieStorage(), config.PKCE_STORAGE_NAME);\n  }\n};\n\nstorageUtil.getHttpCache = function() {\n  if (storageUtil.browserHasLocalStorage()) {\n    return storageBuilder(storageUtil.getLocalStorage(), config.CACHE_STORAGE_NAME);\n  } else if (storageUtil.browserHasSessionStorage()) {\n    return storageBuilder(storageUtil.getSessionStorage(), config.CACHE_STORAGE_NAME);\n  } else {\n    return storageBuilder(storageUtil.getCookieStorage(), config.CACHE_STORAGE_NAME);\n  }\n};\n\nstorageUtil.getLocalStorage = function() {\n  return localStorage;\n};\n\nstorageUtil.getSessionStorage = function() {\n  return sessionStorage;\n};\n\n// Provides webStorage-like interface for cookies\nstorageUtil.getCookieStorage = function(options) {\n  options = options || {};\n  return {\n    getItem: storageUtil.storage.get,\n    setItem: function(key, value) {\n      // Cookie shouldn't expire\n      storageUtil.storage.set(key, value, '2200-01-01T00:00:00.000Z', options.secure);\n    }\n  };\n};\n\nstorageUtil.testStorage = function(storage) {\n  var key = 'okta-test-storage';\n  try {\n    storage.setItem(key, key);\n    storage.removeItem(key);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\nstorageUtil.storage = {\n  set: function(name, value, expiresAt, secure) {\n    var cookieOptions = {\n      path: '/',\n      secure: secure\n    };\n\n    // eslint-disable-next-line no-extra-boolean-cast\n    if (!!(Date.parse(expiresAt))) {\n      // Expires value can be converted to a Date object.\n      //\n      // If the 'expiresAt' value is not provided, or the value cannot be\n      // parsed as a Date object, the cookie will set as a session cookie.\n      cookieOptions.expires = new Date(expiresAt);\n    }\n\n    Cookies.set(name, value, cookieOptions);\n    return storageUtil.storage.get(name);\n  },\n\n  get: function(name) {\n    return Cookies.get(name);\n  },\n\n  delete: function(name) {\n    return Cookies.remove(name, { path: '/' });\n  }\n};\n\nmodule.exports = storageUtil;\n"]},"metadata":{},"sourceType":"script"}